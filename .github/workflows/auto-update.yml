name: Peers.TV Fix Key Updater

on:
  schedule:
    - cron: '0 */3 * * *'
  workflow_dispatch:

jobs:
  fix-update:
    runs-on: ubuntu-latest
    steps:
      - name: üîë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL-encoded –∫–ª—é—á
        run: |
          URL="https://Tipicon80.pythonanywhere.com/update_playlist"
          # –ü–†–ê–í–ò–õ–¨–ù–´–ô URL-encoded –∫–ª—é—á (–Ω–∏–∫–∞–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö!)
          FULL_URL="${URL}?key=kP7%24mN9%40qR2%21sT5%23uV8%25xY3%26zB6%2AaC1%5EdE4"
          
          echo "üîß $(date) - –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–õ–Æ–ß–ê"
          echo "‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–ú –ü–†–û–í–ï–†–ï–ù–ù–´–ô –ö–õ–Æ–ß –ë–ï–ó –ü–ï–†–ï–ú–ï–ù–ù–´–•"
          echo "üîó URL: $FULL_URL"
          
          # –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
          response=$(curl -s -m 60 "$FULL_URL")
          echo "üìÑ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
          echo "$response"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ø–µ—Ö
          if [[ "$response" == *"—É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"* ]]; then
            echo "‚úÖ‚úÖ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û! –ö–õ–Æ–ß –†–ê–ë–û–¢–ê–ï–¢! ‚úÖ‚úÖ‚úÖ"
            exit 0
          else
            echo "‚ùå‚ùå‚ùå –û–®–ò–ë–ö–ê: –∫–ª—é—á –≤—Å—ë –µ—â–µ –Ω–µ–≤–µ—Ä–Ω—ã–π ‚ùå‚ùå‚ùå"
            echo "üí° –°–û–í–ï–¢: —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –í–†–£–ß–ù–£–Æ –∏–∑ —ç—Ç–æ–≥–æ –ª–æ–≥–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
            exit 1
          fi
        env:
          TZ: Europe/Moscow
