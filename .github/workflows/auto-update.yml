name: Peers.TV Playlist Auto-Updater

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞ (UTC –≤—Ä–µ–º—è = –ú–°–ö-3)
    - cron: '0 */3 * * *'
  workflow_dispatch: # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  update-playlist:
    runs-on: ubuntu-latest
    steps:
      - name: üîÑ –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞
        run: |
          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
          URL="https://Tipicon80.pythonanywhere.com/update_playlist"
          SECRET_KEY="kP7%24mN9%40qR2%21sT5%23uV8%25xY3%26zB6%2AaC1%5EdE4"  # URL-encoded –≤–µ—Ä—Å–∏—è –∫–ª—é—á–∞
          FULL_URL="${URL}?key=${SECRET_KEY}"
          
          echo "‚è∞ $(date) - –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
          echo "üîó URL: $FULL_URL"
          
          # –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å —Å —Ç–∞–π–º–∞—É—Ç–æ–º 60 —Å–µ–∫—É–Ω–¥
          response=$(curl -s -m 60 -w "\n%{http_code}" "$FULL_URL")
          status_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "üìÑ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
          echo "$body"
          echo "üî¢ HTTP —Å—Ç–∞—Ç—É—Å: $status_code"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          if [[ "$status_code" == "200" && "$body" == *"—É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"* ]]; then
            echo "‚úÖ‚úÖ‚úÖ –û–ë–ù–û–í–õ–ï–ù–ò–ï –£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û! ‚úÖ‚úÖ‚úÖ"
            exit 0
          else
            echo "‚ùå‚ùå‚ùå –û–®–ò–ë–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–Ø! ‚ùå‚ùå‚ùå"
            echo "–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: $body"
            exit 1
          fi
        env:
          TZ: Europe/Moscow
