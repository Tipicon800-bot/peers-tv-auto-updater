name: Peers.TV Auto Updater

on:
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞
    - cron: '0 */3 * * *'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: üîÑ –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        run: |
          URL="https://Tipicon80.pythonanywhere.com/update_playlist?key=kP7%24mN9%40qR2%21sT5%23uV8%25xY3%26zB6%2AaC1%5EdE4"
          
          echo "‚è∞ $(date) - –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
          echo "üîó URL: $URL"
          
          # –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
          for i in {1..3}; do
            echo "üîÑ –ü–æ–ø—ã—Ç–∫–∞ $i..."
            response=$(curl -s -m 60 "$URL")
            echo "üìÑ –û—Ç–≤–µ—Ç: $response"
            
            if [[ "$response" == *"—É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"* ]]; then
              echo "‚úÖ‚úÖ‚úÖ –£–°–ü–ï–•! ‚úÖ‚úÖ‚úÖ"
              exit 0
            fi
            
            sleep 10
          done
          
          echo "‚ùå‚ùå‚ùå –í–°–ï –ü–û–ü–´–¢–ö–ò –ü–†–û–í–ê–õ–ò–õ–ò–°–¨ ‚ùå‚ùå‚ùå"
          exit 1
        env:
          TZ: Europe/Moscow
