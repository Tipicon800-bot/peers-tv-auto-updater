name: Peers.TV Auto Update

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */3 * * *'

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: üîÑ –ù–∞–¥–µ–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        run: |
          echo "‚è∞ $(date) - –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è"
          echo "üîó URL: https://Tipicon80.pythonanywhere.com/update_playlist?key=kP7%24mN9%40qR2%21sT5%23uV8%25xY3%26zB6%2AaC1%5EdE4"
          
          # –ü—Ä–æ–±—É–µ–º 3 —Ä–∞–∑–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
          for i in {1..3}; do
            echo "üîÑ –ü–æ–ø—ã—Ç–∫–∞ $i..."
            response=$(curl -s -m 60 "https://Tipicon80.pythonanywhere.com/update_playlist?key=kP7%24mN9%40qR2%21sT5%23uV8%25xY3%26zB6%2AaC1%5EdE4")
            echo "üìÑ –û—Ç–≤–µ—Ç: $response"
            
            if [[ "$response" == *"—É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"* ]]; then
              echo "‚úÖ‚úÖ‚úÖ –£–°–ü–ï–•! ‚úÖ‚úÖ‚úÖ"
              exit 0
            fi
            
            sleep 10
          done
          
          echo "‚ùå‚ùå‚ùå –í–°–ï –ü–û–ü–´–¢–ö–ò –ü–†–û–í–ê–õ–ò–õ–ò–°–¨ ‚ùå‚ùå‚ùå"
          exit 1
        env:
          TZ: Europe/Moscow
